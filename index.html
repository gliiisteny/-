<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حروفكم مع عبدالعزيز</title>
    <style>
        body { 
            text-align: center; font-family: Arial, sans-serif; 
            background: #1a1a1a; color: #fff; margin: 0; padding: 20px; 
        }
        h1 { color: #00ff00; text-shadow: 0 0 10px #00ff00; } /* Changed to green */
        p { font-size: 18px; }
        .grid { 
            display: grid; grid-template-columns: repeat(7, 80px); 
            gap: 5px; justify-content: center; margin: 30px auto; 
        }
        .hex { 
            width: 80px; height: 92px; 
            background: #444; 
            display: flex; align-items: center; justify-content: center; 
            border: 2px solid #ddd; 
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); 
            cursor: pointer; font-size: 28px; font-weight: bold; 
            color: #ffd700; font-family: 'Arial Black', sans-serif; 
            transition: transform 0.2s, background 0.3s; 
        }
        .hex:hover { transform: scale(1.1); }
        .player1 { background: #ff6200; color: #fff; border-color: #ff8533; } /* Orange */
        .player2 { background: #00cc00; color: #fff; border-color: #33ff33; } /* Green */
        .edge-orange { background: #cc4e00 !important; border-color: #ff6200; } /* Darker orange */
        .edge-green { background: #009900 !important; border-color: #00cc00; } /* Darker green */
        #message { margin-top: 20px; font-size: 24px; font-weight: bold; }
        #resetButton { 
            background: #ff4040; color: #fff; padding: 10px 20px; 
            border: none; border-radius: 5px; font-size: 18px; 
            cursor: pointer; margin-top: 20px; 
        }
        #resetButton:hover { background: #ff6666; }
    </style>
</head>
<body>
    <h1>حروفكم مع عبدالعزيز</h1>
    <p>اضغط على الخلية لتحديدها. البرتقالي يفوز عند الربط عموديًا، والأخضر يفوز عند الربط أفقيًا!</p>
    <div class="grid" id="board"></div>
    <button id="resetButton">تجديد الخلايا</button>
    <div id="message"></div>
    <script>
        const letters = ["ا", "ب", "ت", "ث", "ج", "ح", "خ", "د", "ذ", "ر", "ز", "س", "ش", "ص", "ض", "ط", "ظ", "ع", "غ", "ف", "ق", "ك", "ل", "م", "ن", "ه", "و", "ي"];
        const board = document.getElementById("board");
        const message = document.getElementById("message");
        const resetButton = document.getElementById("resetButton");
        const size = 7;
        let grid = [];
        let usedLetters = new Set();

        function createBoard() {
            usedLetters.clear();
            board.innerHTML = "";
            grid = [];

            for (let row = 0; row < size; row++) {
                grid[row] = [];
                for (let col = 0; col < size; col++) {
                    // Skip corner cells
                    if ((row === 0 && col === 0) || 
                        (row === 0 && col === size - 1) || 
                        (row === size - 1 && col === 0) || 
                        (row === size - 1 && col === size - 1)) {
                        grid[row][col] = null;
                        continue;
                    }

                    let cell = document.createElement("div");
                    cell.classList.add("hex");
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.dataset.clicks = "0";

                    if (row === 0 || row === size - 1) {
                        cell.classList.add("edge-orange");
                    } else if (col === 0 || col === size - 1) {
                        cell.classList.add("edge-green");
                    } else {
                        let letter;
                        do {
                            letter = letters[Math.floor(Math.random() * letters.length)];
                        } while (usedLetters.has(letter));
                        usedLetters.add(letter);
                        cell.innerText = letter;
                        cell.addEventListener("click", () => selectCell(cell));
                    }

                    board.appendChild(cell);
                    grid[row][col] = cell;
                }
            }
        }

        function selectCell(cell) {
            let clicks = parseInt(cell.dataset.clicks) + 1;
            cell.dataset.clicks = clicks;

            cell.classList.remove("player1", "player2");

            if (clicks === 10) {
                usedLetters.delete(cell.innerText);
                let newLetter;
                do {
                    newLetter = letters[Math.floor(Math.random() * letters.length)];
                } while (usedLetters.has(newLetter));
                usedLetters.add(newLetter);
                cell.innerText = newLetter;
                cell.dataset.clicks = "0";
            } else if (clicks % 2 === 1) {
                cell.classList.add("player1"); // Orange
            } else {
                cell.classList.add("player2"); // Green
            }

            checkWin();
        }

        function checkWin() {
            for (let col = 1; col < size - 1; col++) {
                if (grid[1][col] && dfs(1, col, "player1", new Set())) {
                    message.innerText = "اللاعب البرتقالي فاز!";
                    disableBoard();
                    return;
                }
            }

            for (let row = 1; row < size - 1; row++) {
                if (grid[row][1] && dfs(row, 1, "player2", new Set())) {
                    message.innerText = "اللاعب الأخضر فاز!";
                    disableBoard();
                    return;
                }
            }
        }

        function dfs(row, col, player, visited) {
            if (row < 0 || row >= size || col < 0 || col >= size || 
                visited.has(`${row},${col}`) || !grid[row][col]) return false;
            
            let cell = grid[row][col];
            if (!cell.classList.contains(player)) return false;

            visited.add(`${row},${col}`);

            if (player === "player1" && row === size - 2) return true;
            if (player === "player2" && col === size - 2) return true;

            const directions = [
                [-1, 0], [1, 0], [0, -1], [0, 1], [-1, 1], [1, -1]
            ];

            for (let [dr, dc] of directions) {
                if (dfs(row + dr, col + dc, player, visited)) return true;
            }
            return false;
        }

        function disableBoard() {
            for (let row = 1; row < size - 1; row++) {
                for (let col = 1; col < size - 1; col++) {
                    if (grid[row][col]) {
                        grid[row][col].removeEventListener("click", selectCell);
                    }
                }
            }
        }

        function resetBoard() {
            createBoard();
            message.innerText = "";
        }

        resetButton.addEventListener("click", resetBoard);

        createBoard();
    </script>
</body>
</html>